module VFU(
input clk,
input [63:0][15:0] data_in_A,
input [63:0][15:0] data_in_B,
output [63:0][15:0] mul_out,
output [63:0][15:0] add_out,
output [63:0][15:0] sub_exp_out,
output [127:0][15:0] bypass_out
);
reg state = 0;
reg nextstate = 0;

wire [15:0][15:0] z01;
wire [15:0][15:0] z02;
wire [15:0][15:0] z03;
wire [15:0][15:0] z04;
wire [15:0][15:0] z05;
wire [15:0][15:0] z06;
wire [15:0][15:0] z07;
wire [15:0][15:0] z08;
wire [15:0][15:0] z09;
wire [15:0][15:0] z10;
wire [15:0][15:0] z11;
wire [15:0][15:0] z12;
wire [15:0][15:0] z13;
wire [15:0][15:0] z14;
wire [15:0][15:0] z15;
wire [15:0][15:0] z16;
wire [15:0][15:0] z17;
wire [15:0][15:0] z18;
wire [15:0][15:0] z19;
wire [15:0][15:0] z20;
wire [15:0][15:0] z21;
wire [15:0][15:0] z22;
wire [15:0][15:0] z23;
wire [15:0][15:0] z24;
wire [15:0][15:0] z25;
wire [15:0][15:0] z26;
wire [15:0][15:0] z27;
wire [15:0][15:0] z28;
wire [15:0][15:0] z29;
wire [15:0][15:0] z30;
wire [15:0][15:0] z31;
wire [15:0][15:0] z32;
wire [15:0][15:0] z33;
wire [15:0][15:0] z34;
wire [15:0][15:0] z35;
wire [15:0][15:0] z36;
wire [15:0][15:0] z37;
wire [15:0][15:0] z38;
wire [15:0][15:0] z39;
wire [15:0][15:0] z40;
wire [15:0][15:0] z41;
wire [15:0][15:0] z42;
wire [15:0][15:0] z43;
wire [15:0][15:0] z44;
wire [15:0][15:0] z45;
wire [15:0][15:0] z46;
wire [15:0][15:0] z47;
wire [15:0][15:0] z48;
wire [15:0][15:0] z49;
wire [15:0][15:0] z50;
wire [15:0][15:0] z51;
wire [15:0][15:0] z52;
wire [15:0][15:0] z53;
wire [15:0][15:0] z54;
wire [15:0][15:0] z55;
wire [15:0][15:0] z56;
wire [15:0][15:0] z57;
wire [15:0][15:0] z58;
wire [15:0][15:0] z59;
wire [15:0][15:0] z60;
wire [15:0][15:0] z61;
wire [15:0][15:0] z62;
wire [15:0][15:0] z63;
wire [15:0][15:0] z64;
wire [63:0][15:0] sub_out;

always@(state) begin
case (state)
0:Mul
mul_dsp M01(.clk(clk), X(data_in_A[0][15:0]), Y(data_in_B[0][15:0]), Z(z01));
mul_dsp M02(.clk(clk), X(data_in_A[1][15:0]), Y(data_in_B[1][15:0]), Z(z02));
mul_dsp M03(.clk(clk), X(data_in_A[2][15:0]), Y(data_in_B[2][15:0]), Z(z03));
mul_dsp M04(.clk(clk), X(data_in_A[3][15:0]), Y(data_in_B[3][15:0]), Z(z04));
mul_dsp M05(.clk(clk), X(data_in_A[4][15:0]), Y(data_in_B[4][15:0]), Z(z05));
mul_dsp M06(.clk(clk), X(data_in_A[5][15:0]), Y(data_in_B[5][15:0]), Z(z06));
mul_dsp M07(.clk(clk), X(data_in_A[6][15:0]), Y(data_in_B[6][15:0]), Z(z07));
mul_dsp M08(.clk(clk), X(data_in_A[7][15:0]), Y(data_in_B[7][15:0]), Z(z08));
mul_dsp M09(.clk(clk), X(data_in_A[8][15:0]), Y(data_in_B[8][15:0]), Z(z09));
mul_dsp M10(.clk(clk), X(data_in_A[9][15:0]), Y(data_in_B[9][15:0]), Z(z10));
mul_dsp M11(.clk(clk), X(data_in_A[10][15:0]), Y(data_in_B[10][15:0]), Z(z11));
mul_dsp M12(.clk(clk), X(data_in_A[11][15:0]), Y(data_in_B[11][15:0]), Z(z12));
mul_dsp M13(.clk(clk), X(data_in_A[12][15:0]), Y(data_in_B[12][15:0]), Z(z13));
mul_dsp M14(.clk(clk), X(data_in_A[13][15:0]), Y(data_in_B[13][15:0]), Z(z14));
mul_dsp M15(.clk(clk), X(data_in_A[14][15:0]), Y(data_in_B[14][15:0]), Z(z15));
mul_dsp M16(.clk(clk), X(data_in_A[15][15:0]), Y(data_in_B[15][15:0]), Z(z16));
mul_dsp M17(.clk(clk), X(data_in_A[16][15:0]), Y(data_in_B[16][15:0]), Z(z17));
mul_dsp M18(.clk(clk), X(data_in_A[17][15:0]), Y(data_in_B[17][15:0]), Z(z18));
mul_dsp M19(.clk(clk), X(data_in_A[18][15:0]), Y(data_in_B[18][15:0]), Z(z19));
mul_dsp M20(.clk(clk), X(data_in_A[19][15:0]), Y(data_in_B[19][15:0]), Z(z20));
mul_dsp M21(.clk(clk), X(data_in_A[20][15:0]), Y(data_in_B[20][15:0]), Z(z21));
mul_dsp M21(.clk(clk), X(data_in_A[20][15:0]), Y(data_in_B[20][15:0]), Z(z21));
mul_dsp M22(.clk(clk), X(data_in_A[21][15:0]), Y(data_in_B[21][15:0]), Z(z22));
mul_dsp M23(.clk(clk), X(data_in_A[22][15:0]), Y(data_in_B[22][15:0]), Z(z23));
mul_dsp M24(.clk(clk), X(data_in_A[23][15:0]), Y(data_in_B[23][15:0]), Z(z24));
mul_dsp M25(.clk(clk), X(data_in_A[24][15:0]), Y(data_in_B[24][15:0]), Z(z25));
mul_dsp M26(.clk(clk), X(data_in_A[25][15:0]), Y(data_in_B[25][15:0]), Z(z26));
mul_dsp M27(.clk(clk), X(data_in_A[26][15:0]), Y(data_in_B[26][15:0]), Z(z27));
mul_dsp M28(.clk(clk), X(data_in_A[27][15:0]), Y(data_in_B[27][15:0]), Z(z28));
mul_dsp M29(.clk(clk), X(data_in_A[28][15:0]), Y(data_in_B[28][15:0]), Z(z29));
mul_dsp M30(.clk(clk), X(data_in_A[29][15:0]), Y(data_in_B[29][15:0]), Z(z30));
mul_dsp M31(.clk(clk), X(data_in_A[30][15:0]), Y(data_in_B[30][15:0]), Z(z31));
mul_dsp M32(.clk(clk), X(data_in_A[31][15:0]), Y(data_in_B[31][15:0]), Z(z32));
mul_dsp M33(.clk(clk), X(data_in_A[32][15:0]), Y(data_in_B[32][15:0]), Z(z33));
mul_dsp M34(.clk(clk), X(data_in_A[33][15:0]), Y(data_in_B[33][15:0]), Z(z34));
mul_dsp M35(.clk(clk), X(data_in_A[34][15:0]), Y(data_in_B[34][15:0]), Z(z35));
mul_dsp M36(.clk(clk), X(data_in_A[35][15:0]), Y(data_in_B[35][15:0]), Z(z36));
mul_dsp M37(.clk(clk), X(data_in_A[36][15:0]), Y(data_in_B[36][15:0]), Z(z37));
mul_dsp M38(.clk(clk), X(data_in_A[37][15:0]), Y(data_in_B[37][15:0]), Z(z38));
mul_dsp M39(.clk(clk), X(data_in_A[38][15:0]), Y(data_in_B[38][15:0]), Z(z39));
mul_dsp M40(.clk(clk), X(data_in_A[39][15:0]), Y(data_in_B[39][15:0]), Z(z40));
mul_dsp M41(.clk(clk), X(data_in_A[40][15:0]), Y(data_in_B[40][15:0]), Z(z41));
mul_dsp M42(.clk(clk), X(data_in_A[41][15:0]), Y(data_in_B[41][15:0]), Z(z42));
mul_dsp M43(.clk(clk), X(data_in_A[42][15:0]), Y(data_in_B[42][15:0]), Z(z43));
mul_dsp M44(.clk(clk), X(data_in_A[43][15:0]), Y(data_in_B[43][15:0]), Z(z44));
mul_dsp M45(.clk(clk), X(data_in_A[44][15:0]), Y(data_in_B[44][15:0]), Z(z45));
mul_dsp M46(.clk(clk), X(data_in_A[45][15:0]), Y(data_in_B[45][15:0]), Z(z46));
mul_dsp M47(.clk(clk), X(data_in_A[46][15:0]), Y(data_in_B[46][15:0]), Z(z47));
mul_dsp M48(.clk(clk), X(data_in_A[47][15:0]), Y(data_in_B[47][15:0]), Z(z48));
mul_dsp M49(.clk(clk), X(data_in_A[48][15:0]), Y(data_in_B[48][15:0]), Z(z49));
mul_dsp M50(.clk(clk), X(data_in_A[49][15:0]), Y(data_in_B[49][15:0]), Z(z50));
mul_dsp M51(.clk(clk), X(data_in_A[50][15:0]), Y(data_in_B[50][15:0]), Z(z51));
mul_dsp M52(.clk(clk), X(data_in_A[51][15:0]), Y(data_in_B[51][15:0]), Z(z52));
mul_dsp M53(.clk(clk), X(data_in_A[52][15:0]), Y(data_in_B[52][15:0]), Z(z53));
mul_dsp M54(.clk(clk), X(data_in_A[53][15:0]), Y(data_in_B[53][15:0]), Z(z54));
mul_dsp M55(.clk(clk), X(data_in_A[54][15:0]), Y(data_in_B[54][15:0]), Z(z55));
mul_dsp M56(.clk(clk), X(data_in_A[55][15:0]), Y(data_in_B[55][15:0]), Z(z56));
mul_dsp M57(.clk(clk), X(data_in_A[56][15:0]), Y(data_in_B[56][15:0]), Z(z57));
mul_dsp M58(.clk(clk), X(data_in_A[57][15:0]), Y(data_in_B[57][15:0]), Z(z58));
mul_dsp M59(.clk(clk), X(data_in_A[58][15:0]), Y(data_in_B[58][15:0]), Z(z59));
mul_dsp M60(.clk(clk), X(data_in_A[59][15:0]), Y(data_in_B[59][15:0]), Z(z60));
mul_dsp M61(.clk(clk), X(data_in_A[60][15:0]), Y(data_in_B[60][15:0]), Z(z61));
mul_dsp M62(.clk(clk), X(data_in_A[61][15:0]), Y(data_in_B[61][15:0]), Z(z62));
mul_dsp M63(.clk(clk), X(data_in_A[62][15:0]), Y(data_in_B[62][15:0]), Z(z63));
mul_dsp M64(.clk(clk), X(data_in_A[63][15:0]), Y(data_in_B[63][15:0]), Z(z64));
mul_out = {z01, z02, z03, z04};

1:Sub
sub_dsp S01(.clk(clk), X(data_in_A[0][15:0]), Y(data_in_B[0][15:0]), Z(z01));
sub_dsp S02(.clk(clk), X(data_in_A[1][15:0]), Y(data_in_B[1][15:0]), Z(z02));
sub_dsp S03(.clk(clk), X(data_in_A[2][15:0]), Y(data_in_B[2][15:0]), Z(z03));
sub_dsp S04(.clk(clk), X(data_in_A[3][15:0]), Y(data_in_B[3][15:0]), Z(z04));
sub_dsp S05(.clk(clk), X(data_in_A[4][15:0]), Y(data_in_B[4][15:0]), Z(z05));
sub_dsp S06(.clk(clk), X(data_in_A[5][15:0]), Y(data_in_B[5][15:0]), Z(z06));
sub_dsp S07(.clk(clk), X(data_in_A[6][15:0]), Y(data_in_B[6][15:0]), Z(z07));
sub_dsp S08(.clk(clk), X(data_in_A[7][15:0]), Y(data_in_B[7][15:0]), Z(z08));
sub_dsp S09(.clk(clk), X(data_in_A[8][15:0]), Y(data_in_B[8][15:0]), Z(z09));
sub_dsp S10(.clk(clk), X(data_in_A[9][15:0]), Y(data_in_B[9][15:0]), Z(z10));
sub_dsp S11(.clk(clk), X(data_in_A[10][15:0]), Y(data_in_B[10][15:0]), Z(z11));
sub_dsp S12(.clk(clk), X(data_in_A[11][15:0]), Y(data_in_B[11][15:0]), Z(z12));
sub_dsp S13(.clk(clk), X(data_in_A[12][15:0]), Y(data_in_B[12][15:0]), Z(z13));
sub_dsp S14(.clk(clk), X(data_in_A[13][15:0]), Y(data_in_B[13][15:0]), Z(z14));
sub_dsp S15(.clk(clk), X(data_in_A[14][15:0]), Y(data_in_B[14][15:0]), Z(z15));
sub_dsp S16(.clk(clk), X(data_in_A[15][15:0]), Y(data_in_B[15][15:0]), Z(z16));
sub_dsp S17(.clk(clk), X(data_in_A[16][15:0]), Y(data_in_B[16][15:0]), Z(z17));
sub_dsp S18(.clk(clk), X(data_in_A[17][15:0]), Y(data_in_B[17][15:0]), Z(z18));
sub_dsp S19(.clk(clk), X(data_in_A[18][15:0]), Y(data_in_B[18][15:0]), Z(z19));
sub_dsp S20(.clk(clk), X(data_in_A[19][15:0]), Y(data_in_B[19][15:0]), Z(z20));
sub_dsp S21(.clk(clk), X(data_in_A[20][15:0]), Y(data_in_B[20][15:0]), Z(z21));
sub_dsp S22(.clk(clk), X(data_in_A[21][15:0]), Y(data_in_B[21][15:0]), Z(z22));
sub_dsp S23(.clk(clk), X(data_in_A[22][15:0]), Y(data_in_B[22][15:0]), Z(z23));
sub_dsp S24(.clk(clk), X(data_in_A[23][15:0]), Y(data_in_B[23][15:0]), Z(z24));
sub_dsp S25(.clk(clk), X(data_in_A[24][15:0]), Y(data_in_B[24][15:0]), Z(z25));
sub_dsp S26(.clk(clk), X(data_in_A[25][15:0]), Y(data_in_B[25][15:0]), Z(z26));
sub_dsp S27(.clk(clk), X(data_in_A[26][15:0]), Y(data_in_B[26][15:0]), Z(z27));
sub_dsp S28(.clk(clk), X(data_in_A[27][15:0]), Y(data_in_B[27][15:0]), Z(z28));
sub_dsp S29(.clk(clk), X(data_in_A[28][15:0]), Y(data_in_B[28][15:0]), Z(z29));
sub_dsp S30(.clk(clk), X(data_in_A[29][15:0]), Y(data_in_B[29][15:0]), Z(z30));
sub_dsp S31(.clk(clk), X(data_in_A[30][15:0]), Y(data_in_B[30][15:0]), Z(z31));
sub_dsp S32(.clk(clk), X(data_in_A[31][15:0]), Y(data_in_B[31][15:0]), Z(z32));
sub_dsp S33(.clk(clk), X(data_in_A[32][15:0]), Y(data_in_B[32][15:0]), Z(z33));
sub_dsp S34(.clk(clk), X(data_in_A[33][15:0]), Y(data_in_B[33][15:0]), Z(z34));
sub_dsp S35(.clk(clk), X(data_in_A[34][15:0]), Y(data_in_B[34][15:0]), Z(z35));
sub_dsp S36(.clk(clk), X(data_in_A[35][15:0]), Y(data_in_B[35][15:0]), Z(z36));
sub_dsp S37(.clk(clk), X(data_in_A[36][15:0]), Y(data_in_B[36][15:0]), Z(z37));
sub_dsp S38(.clk(clk), X(data_in_A[37][15:0]), Y(data_in_B[37][15:0]), Z(z38));
sub_dsp S39(.clk(clk), X(data_in_A[38][15:0]), Y(data_in_B[38][15:0]), Z(z39));
sub_dsp S40(.clk(clk), X(data_in_A[39][15:0]), Y(data_in_B[39][15:0]), Z(z40));
sub_dsp S41(.clk(clk), X(data_in_A[40][15:0]), Y(data_in_B[40][15:0]), Z(z41));
sub_dsp S42(.clk(clk), X(data_in_A[41][15:0]), Y(data_in_B[41][15:0]), Z(z42));
sub_dsp S43(.clk(clk), X(data_in_A[42][15:0]), Y(data_in_B[42][15:0]), Z(z43));
sub_dsp S44(.clk(clk), X(data_in_A[43][15:0]), Y(data_in_B[43][15:0]), Z(z44));
sub_dsp S45(.clk(clk), X(data_in_A[44][15:0]), Y(data_in_B[44][15:0]), Z(z45));
sub_dsp S46(.clk(clk), X(data_in_A[45][15:0]), Y(data_in_B[45][15:0]), Z(z46));
sub_dsp S47(.clk(clk), X(data_in_A[46][15:0]), Y(data_in_B[46][15:0]), Z(z47));
sub_dsp S48(.clk(clk), X(data_in_A[47][15:0]), Y(data_in_B[47][15:0]), Z(z48));
sub_dsp S49(.clk(clk), X(data_in_A[48][15:0]), Y(data_in_B[48][15:0]), Z(z49));
sub_dsp S50(.clk(clk), X(data_in_A[49][15:0]), Y(data_in_B[49][15:0]), Z(z50));
sub_dsp S51(.clk(clk), X(data_in_A[50][15:0]), Y(data_in_B[50][15:0]), Z(z51));
sub_dsp S52(.clk(clk), X(data_in_A[51][15:0]), Y(data_in_B[51][15:0]), Z(z52));
sub_dsp S53(.clk(clk), X(data_in_A[52][15:0]), Y(data_in_B[52][15:0]), Z(z53));
sub_dsp S54(.clk(clk), X(data_in_A[53][15:0]), Y(data_in_B[53][15:0]), Z(z54));
sub_dsp S55(.clk(clk), X(data_in_A[54][15:0]), Y(data_in_B[54][15:0]), Z(z55));
sub_dsp S56(.clk(clk), X(data_in_A[55][15:0]), Y(data_in_B[55][15:0]), Z(z56));
sub_dsp S57(.clk(clk), X(data_in_A[56][15:0]), Y(data_in_B[56][15:0]), Z(z57));
sub_dsp S58(.clk(clk), X(data_in_A[57][15:0]), Y(data_in_B[57][15:0]), Z(z58));
sub_dsp S59(.clk(clk), X(data_in_A[58][15:0]), Y(data_in_B[58][15:0]), Z(z59));
sub_dsp S60(.clk(clk), X(data_in_A[59][15:0]), Y(data_in_B[59][15:0]), Z(z60));
sub_dsp S61(.clk(clk), X(data_in_A[60][15:0]), Y(data_in_B[60][15:0]), Z(z61));
sub_dsp S62(.clk(clk), X(data_in_A[61][15:0]), Y(data_in_B[61][15:0]), Z(z62));
sub_dsp S63(.clk(clk), X(data_in_A[62][15:0]), Y(data_in_B[62][15:0]), Z(z63));
sub_dsp S64(.clk(clk), X(data_in_A[63][15:0]), Y(data_in_B[63][15:0]), Z(z64));
sub_out = {z01, z02, z03, z04};
nextstate = 2;

2:Exp
exp_dsp E(.clk(clk), X(sub_out), Y(sub_exp_out));

3:Bypass
bypass_out={data_in_A, data_in_B};
end

always @(podsge clock) begin
	state <= nextstate;
end

endmodule
